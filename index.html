<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="Doop Framework 101 : Tutorial site for PLDI 2015">

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Doop Framework 101</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/plast-lab/doop-pldi15-tutorial">View on GitHub</a>

          <h1 id="project_title">Doop Framework 101</h1>
          <h2 id="project_tagline">Tutorial site for PLDI 2015</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/plast-lab/doop-pldi15-tutorial/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/plast-lab/doop-pldi15-tutorial/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h2>
<a id="about" class="anchor" href="#about" aria-hidden="true"><span class="octicon octicon-link"></span></a>About</h2>

<p><a href="http://doop.program-analysis.org/">Doop</a> is a <strong>declarative</strong> framework for Static Analysis of Java programs, centered on a variety of <strong>pointer analysis</strong> algorithms. Doop provides a huge variety of analyses and also the surrounding scaffolding to run an analysis end-to-end (fact generation, processing, statistics, etc.).</p>

<p>The declarative nature of Doop stems from its use of <strong>Datalog</strong> (more specifically <em>LogiQL</em>, a Datalog dialect developed by <a href="http://www.logicblox.com/">LogicBlox</a>) to specify an analysis.</p>

<p>The building blocks of Datalog programs come in the form of <strong>predicates</strong>. Our input facts (a.k.a. <em>EDB</em> logic) are represented as predicate values, e.g., <code>Person("John")</code> or <code>Parent("John", "Johnny jr")</code>.</p>

<p>Then we have <strong>rules</strong> (a.k.a. <em>IDB</em> logic) to infer new information from facts already known to be true. This continues until no new information can be extracted. E.g.,</p>

<pre><code>Ancestor(x, y) &lt;- Parent(x, y).
</code></pre>

<p>To familiarize yourself with Datalog evaluation, you may want to try the <a href="https://developer.logicblox.com/content/docs4/tutorial/repl/section/split.html">LogicBlox REPL tutorial</a>.</p>

<h3>
<a id="doop--datalog-setup" class="anchor" href="#doop--datalog-setup" aria-hidden="true"><span class="octicon octicon-link"></span></a>Doop + Datalog Setup</h3>

<p>Please use engine version 3.10 for this tutorial and download+unpack the main tutorial file from the links at the top of the page. If you are following this tutorial off-line, the relevant files should exist in the
archive you copied.</p>

<pre><code>$ cd tutorial_root_folder
$ source environment.sh
</code></pre>

<h3>
<a id="toy-example" class="anchor" href="#toy-example" aria-hidden="true"><span class="octicon octicon-link"></span></a>Toy Example</h3>

<p>We want to compute the ancestors for a set of people. Our rules (left-arrow notation) along with their type declarations (right-arrow notation) are in <a href="https://raw.githubusercontent.com/plast-lab/doop-pldi15-tutorial/gh-pages/code/examples/ancestors/ancestors.logic">ancestors.logic</a>. Our facts (a.k.a. delta logic) are in <a href="https://raw.githubusercontent.com/plast-lab/doop-pldi15-tutorial/gh-pages/code/examples/ancestors/facts.logic">facts.logic</a>. The <code>+</code> operator in front of the delta predicates denotes that we want to add facts to our database (we could also remove or update facts).</p>

<p>We invoke actions on our Datalog engine using <code>bloxbatch</code>.</p>

<pre><code>$ bloxbatch -db DB -create -overwrite              # create our database
$ bloxbatch -db DB -addBlock -file ancestor.logic  # load our rules
$ bloxbatch -db DB -execute -file facts.logic      # load our facts
$ bloxbatch -db DB -print ancestor                 # print computed results
predicate: Ancestor(Person, Person)
...
/--- start of Ancestor facts ---\
  [1]john, [0]harry
  [2]dave, [0]harry
  [2]dave, [1]john
\---- end of Ancestor facts ----/
</code></pre>

<p>The line <code>Person(x), Name(x:n) -&gt; string(n).</code> states that a person (represented by an internal ID) can be constructed by providing a string in the <code>Name</code> predicate. This is known as <em>refmode</em>. This is also shown in the print output. For example, <code>[1]john</code> means that the string <em>"john"</em> is used to create a Person with the ID <em>1</em>.</p>

<h2>
<a id="doop-examples" class="anchor" href="#doop-examples" aria-hidden="true"><span class="octicon octicon-link"></span></a>Doop Examples</h2>

<p>Now let's focus on more meaningful examples using Doop directly. Doop is available at bitbucket as a <a href="https://bitbucket.org/yanniss/doop">public repo</a>.</p>

<p>We will use a running example, found in <a href="https://raw.githubusercontent.com/plast-lab/doop-pldi15-tutorial/gh-pages/code/examples/Example.java">Example.java</a>.</p>

<pre><code>$ cd doop
$ mkjar Example.java   # create Example.jar
</code></pre>

<p>We will run a simple naive analysis (<code>-a naive</code> option) on the generated jar file (<code>-j Example.jar</code> option). This analysis has only a few basic rules but it's a good representative skeleton of actual analyses. Since Doop performs a <strong>whole program analysis</strong>, the library will be analyzed along with application code. With the option <code>--jre 1.7</code> we specify the desired version of the library. </p>

<pre><code>./doop -a naive -j Example.jar --jre 1.7 --no-stats
</code></pre>

<p>After the analysis has run, we can gather results by issuing queries directly to the database.</p>

<h3>
<a id="analysis-structure" class="anchor" href="#analysis-structure" aria-hidden="true"><span class="octicon octicon-link"></span></a>Analysis structure</h3>

<p>Input facts are auto-generated by the framework (using <a href="https://github.com/Sable/soot">Soot</a>) and the schema can be found</p>

<ul>
<li>in <code>logic/facts/declarations.logic</code>
</li>
<li>and in <code>logic/facts/flow-insensitivity-declarations.logic</code>.</li>
</ul>

<p>The rules for our naive analysis can be found in <code>logic/analyses/naive/analysis.logic</code>.</p>

<p>For example, the following rule states that <strong>when</strong> we have a heap allocation of a <code>?heap</code> object that is assigned to variable <code>?var</code> inside a method deemed reachable by our analysis, <strong>then</strong> we can infer that the variable may point to this heap object.</p>

<pre><code>VarPointsTo(?var, ?heap) &lt;-
  AssignHeapAllocation(?heap, ?var, ?inMethod),
  Reachable(?inMethod).
</code></pre>

<p>Furthermore, <strong>when</strong> we have some kind of assignment (direct or indirect) from one variable to another, and we know that the source variable may point to some heap object, <strong>then</strong> the target variable may point to the same heap object.</p>

<pre><code>VarPointsTo(?to, ?heap) &lt;-
  Assign(?to, ?from),
  VarPointsTo(?from, ?heap).
</code></pre>

<p>Note here that this rule is <strong>recursive</strong>; previously known facts about the <em>VarPointTo</em> relation may lead to the inference of additional facts. Doop analysis rules are <strong>mutually recursive</strong> in complex ways.</p>

<h2>
<a id="queries" class="anchor" href="#queries" aria-hidden="true"><span class="octicon octicon-link"></span></a>Queries</h2>

<h3>
<a id="objects" class="anchor" href="#objects" aria-hidden="true"><span class="octicon octicon-link"></span></a>Objects</h3>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Doop Framework 101 maintained by <a href="https://github.com/plast-lab">plast-lab</a></p>
        <p>Published with <a href="https://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
